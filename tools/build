export ARCH=aarch64
#export CROSS_COMPILE=/home/qixxu01/tools/aarch64bare/bin/aarch64-elf-
export CROSS_COMPILE=/home/qixxu01/tools/aarch64/bin/aarch64-linux-gnu-
pushd u-boot
make -j 16 O=out/ vexpress_aemv8a_semi_config
make -j 16 O=out/
popd

pushd arm-tf
make -j 16 PLAT=fvp ARCH=aarch64 DEBUG=1 ARM_TSP_RAM_LOCATION=dram BL33=../u-boot/out/u-boot.bin \
				TRUSTED_BOARD_BOOT=1 ARM_ROTPK_LOCATION=devel_rsa \
				              KEY_ALG=rsa TF_MBEDTLS_KEY_ALG=rsa ROT_KEY=./plat/arm/board/common/rotpk/arm_rotprivk_rsa.pem   MBEDTLS_DIR=../mbedtls GENERATE_COT=1 \
							  dtbs all fip

popd


pushd linux 
mkdir out/
export ARCH=arm64
scripts/kconfig/merge_config.sh -O out/ linaro/configs/linaro-base.conf linaro/configs/linaro-base-arm64.conf linaro/configs/big-LITTLE-MP.conf linaro/configs/vexpress64.conf
make O=out/ -j16 Image dtbs
popd

pushd busybox
export ARCH=arm64
mkdir -p out/
make O=out defconfig
sed -i 's/# CONFIG_STATIC is not set/CONFIG_STATIC=y/g' out/.config
make O=out/ -j 16 install
popd

pushd ramdisk
cp ../busybox/out/_install/bin/busybox .
../linux/out/usr/gen_init_cpio files.txt > ramdisk-busybox.img
../u-boot/out/tools/mkimage  -A arm64 -O linux -C none -T ramdisk -n ramdisk -a 0x88000000 -e 0x88000000 -n "BusyBox ramdisk" -d ramdisk-busybox.img ramdisk.img
popd
